<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Fate of precipitation | Hydraulics and Water Resources: Examples Using R</title>
  <meta name="description" content="<p>A compilation of fluid mechanics, hydraulics, and water resources
engineering exercises using R.</p>" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Fate of precipitation | Hydraulics and Water Resources: Examples Using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>A compilation of fluid mechanics, hydraulics, and water resources
engineering exercises using R.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Fate of precipitation | Hydraulics and Water Resources: Examples Using R" />
  
  <meta name="twitter:description" content="<p>A compilation of fluid mechanics, hydraulics, and water resources
engineering exercises using R.</p>" />
  



<meta name="date" content="2024-09-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-hydrologic-cycle-and-precipitation.html"/>
<link rel="next" href="designing-for-floods-flood-hydrology.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Hydraulics and Water Resources:<br>Examples Using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction-to-r-and-rstudio"><i class="fa fa-check"></i>Introduction to R and RStudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citing-this-reference"><i class="fa fa-check"></i>Citing this reference</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#copyright"><i class="fa fa-check"></i>Copyright</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="units-in-fluid-mechanics.html"><a href="units-in-fluid-mechanics.html"><i class="fa fa-check"></i><b>1</b> Units in Fluid Mechanics</a></li>
<li class="chapter" data-level="2" data-path="properties-of-water.html"><a href="properties-of-water.html"><i class="fa fa-check"></i><b>2</b> Properties of water (and air)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="properties-of-water.html"><a href="properties-of-water.html#properties-important-for-water-standing-still"><i class="fa fa-check"></i><b>2.1</b> Properties important for water standing still</a></li>
<li class="chapter" data-level="2.2" data-path="properties-of-water.html"><a href="properties-of-water.html#properties-important-for-moving-water"><i class="fa fa-check"></i><b>2.2</b> Properties important for moving water</a></li>
<li class="chapter" data-level="2.3" data-path="properties-of-water.html"><a href="properties-of-water.html#atmosperic-properties"><i class="fa fa-check"></i><b>2.3</b> Atmosperic Properties</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="properties-of-water.html"><a href="properties-of-water.html#ideal-gas-law"><i class="fa fa-check"></i><b>2.3.1</b> Ideal gas law</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hydrostatics---forces-exerted-by-water-bodies.html"><a href="hydrostatics---forces-exerted-by-water-bodies.html"><i class="fa fa-check"></i><b>3</b> Hydrostatics - forces exerted by water bodies</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hydrostatics---forces-exerted-by-water-bodies.html"><a href="hydrostatics---forces-exerted-by-water-bodies.html#pressure-and-force"><i class="fa fa-check"></i><b>3.1</b> Pressure and force</a></li>
<li class="chapter" data-level="3.2" data-path="hydrostatics---forces-exerted-by-water-bodies.html"><a href="hydrostatics---forces-exerted-by-water-bodies.html#hs-plane"><i class="fa fa-check"></i><b>3.2</b> Force on a plane area</a></li>
<li class="chapter" data-level="3.3" data-path="hydrostatics---forces-exerted-by-water-bodies.html"><a href="hydrostatics---forces-exerted-by-water-bodies.html#forces-on-curved-surfaces"><i class="fa fa-check"></i><b>3.3</b> Forces on curved surfaces</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html"><i class="fa fa-check"></i><b>4</b> Water flowing in pipes: energy losses</a>
<ul>
<li class="chapter" data-level="4.1" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#important-dimensionless-quantity"><i class="fa fa-check"></i><b>4.1</b> Important dimensionless quantity</a></li>
<li class="chapter" data-level="4.2" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#friction-loss-in-circular-pipes"><i class="fa fa-check"></i><b>4.2</b> Friction Loss in Circular Pipes</a></li>
<li class="chapter" data-level="4.3" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-pipe-friction-problems"><i class="fa fa-check"></i><b>4.3</b> Solving Pipe friction problems</a></li>
<li class="chapter" data-level="4.4" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#type1"><i class="fa fa-check"></i><b>4.4</b> Solving for head loss (Type 1 problems)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-head-loss-by-manual-iteration"><i class="fa fa-check"></i><b>4.4.1</b> Solving for head loss by manual iteration</a></li>
<li class="chapter" data-level="4.4.2" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#dwapprox"><i class="fa fa-check"></i><b>4.4.2</b> Solving for headloss using an empirical approximation</a></li>
<li class="chapter" data-level="4.4.3" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#coleb-solver"><i class="fa fa-check"></i><b>4.4.3</b> Solving for head loss using an equation solver</a></li>
<li class="chapter" data-level="4.4.4" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-head-loss-using-an-r-package"><i class="fa fa-check"></i><b>4.4.4</b> Solving for head loss using an R package</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-flow-or-velocity-type-2-problems"><i class="fa fa-check"></i><b>4.5</b> Solving for Flow or Velocity (Type 2 problems)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-q-or-v-using-manual-iteration"><i class="fa fa-check"></i><b>4.5.1</b> Solving for Q (or V) using manual iteration</a></li>
<li class="chapter" data-level="4.5.2" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-q-using-an-explicit-equation"><i class="fa fa-check"></i><b>4.5.2</b> Solving for Q Using an Explicit Equation</a></li>
<li class="chapter" data-level="4.5.3" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-q-using-an-r-package"><i class="fa fa-check"></i><b>4.5.3</b> Solving for Q Using an R package</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-pipe-diameter-d-type-3-problems"><i class="fa fa-check"></i><b>4.6</b> Solving for pipe diameter, D (Type 3 problems)</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-d-using-manual-iterations"><i class="fa fa-check"></i><b>4.6.1</b> Solving for D using manual iterations</a></li>
<li class="chapter" data-level="4.6.2" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-d-using-an-equation-solver"><i class="fa fa-check"></i><b>4.6.2</b> Solving for D using an equation solver</a></li>
<li class="chapter" data-level="4.6.3" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#solving-for-d-using-an-r-package"><i class="fa fa-check"></i><b>4.6.3</b> Solving for D using an R package</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#parallel-pipes-solving-a-system-of-equations"><i class="fa fa-check"></i><b>4.7</b> Parallel pipes: solving a system of equations</a></li>
<li class="chapter" data-level="4.8" data-path="water-flowing-in-pipes-energy-losses.html"><a href="water-flowing-in-pipes-energy-losses.html#simple-pipe-networks-the-hardy-cross-method"><i class="fa fa-check"></i><b>4.8</b> Simple pipe networks: the Hardy-Cross method</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html"><i class="fa fa-check"></i><b>5</b> Flow in open channels</a>
<ul>
<li class="chapter" data-level="5.1" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#an-important-dimensionless-quantity"><i class="fa fa-check"></i><b>5.1</b> An important dimensionless quantity</a></li>
<li class="chapter" data-level="5.2" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#equations-for-open-channel-flow"><i class="fa fa-check"></i><b>5.2</b> Equations for open channel flow</a></li>
<li class="chapter" data-level="5.3" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#trap"><i class="fa fa-check"></i><b>5.3</b> Trapezoidal channels</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#solving-the-manning-equation-in-r"><i class="fa fa-check"></i><b>5.3.1</b> Solving the Manning equation in R</a></li>
<li class="chapter" data-level="5.3.2" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#solving-the-manning-equation-with-the-hydraulics-r-package"><i class="fa fa-check"></i><b>5.3.2</b> Solving the Manning equation with the <em>hydraulics</em> R package</a></li>
<li class="chapter" data-level="5.3.3" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#solving-the-manning-equation-using-a-spreadsheet-like-excel"><i class="fa fa-check"></i><b>5.3.3</b> Solving the Manning equation using a spreadsheet like Excel</a></li>
<li class="chapter" data-level="5.3.4" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#optimal-trapezoidal-geometry"><i class="fa fa-check"></i><b>5.3.4</b> Optimal trapezoidal geometry</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#circ"><i class="fa fa-check"></i><b>5.4</b> Circular Channels (flowing partially full)</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#solving-the-manning-equation-for-a-circular-pipe-in-r"><i class="fa fa-check"></i><b>5.4.1</b> Solving the Manning equation for a circular pipe in R</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#crit-section"><i class="fa fa-check"></i><b>5.5</b> Critical flow</a></li>
<li class="chapter" data-level="5.6" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#flow-in-rectangular-channels"><i class="fa fa-check"></i><b>5.6</b> Flow in Rectangular Channels</a></li>
<li class="chapter" data-level="5.7" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#gvf-section"><i class="fa fa-check"></i><b>5.7</b> Gradually varied steady flow</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#the-direct-step-method"><i class="fa fa-check"></i><b>5.7.1</b> The direct step method</a></li>
<li class="chapter" data-level="5.7.2" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#standard-step-method"><i class="fa fa-check"></i><b>5.7.2</b> Standard step method</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#hj-section"><i class="fa fa-check"></i><b>5.8</b> Rapidly varied flow (the hydraulic jump)</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#sequent-or-conjugate-depths"><i class="fa fa-check"></i><b>5.8.1</b> Sequent (or conjugate) depths</a></li>
<li class="chapter" data-level="5.8.2" data-path="flow-in-open-channels.html"><a href="flow-in-open-channels.html#location-of-a-hydraulic-jump"><i class="fa fa-check"></i><b>5.8.2</b> Location of a hydraulic jump</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="momentum-in-water-flow.html"><a href="momentum-in-water-flow.html"><i class="fa fa-check"></i><b>6</b> Momentum in water flow</a>
<ul>
<li class="chapter" data-level="6.1" data-path="momentum-in-water-flow.html"><a href="momentum-in-water-flow.html#equations-of-linear-momentum"><i class="fa fa-check"></i><b>6.1</b> Equations of linear momentum</a></li>
<li class="chapter" data-level="6.2" data-path="momentum-in-water-flow.html"><a href="momentum-in-water-flow.html#the-momentum-equation-in-pipe-design"><i class="fa fa-check"></i><b>6.2</b> The momentum equation in pipe design</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="pumps-and-how-they-operate-in-a-hydraulic-system.html"><a href="pumps-and-how-they-operate-in-a-hydraulic-system.html"><i class="fa fa-check"></i><b>7</b> Pumps and how they operate in a hydraulic system</a>
<ul>
<li class="chapter" data-level="7.1" data-path="pumps-and-how-they-operate-in-a-hydraulic-system.html"><a href="pumps-and-how-they-operate-in-a-hydraulic-system.html#defining-the-system-curve"><i class="fa fa-check"></i><b>7.1</b> Defining the system curve</a></li>
<li class="chapter" data-level="7.2" data-path="pumps-and-how-they-operate-in-a-hydraulic-system.html"><a href="pumps-and-how-they-operate-in-a-hydraulic-system.html#defining-the-pump-characteristic-curve"><i class="fa fa-check"></i><b>7.2</b> Defining the pump characteristic curve</a></li>
<li class="chapter" data-level="7.3" data-path="pumps-and-how-they-operate-in-a-hydraulic-system.html"><a href="pumps-and-how-they-operate-in-a-hydraulic-system.html#finding-the-operating-point"><i class="fa fa-check"></i><b>7.3</b> Finding the operating point</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="the-hydrologic-cycle-and-precipitation.html"><a href="the-hydrologic-cycle-and-precipitation.html"><i class="fa fa-check"></i><b>8</b> The hydrologic cycle and precipitation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="the-hydrologic-cycle-and-precipitation.html"><a href="the-hydrologic-cycle-and-precipitation.html#the-hydrologic-cycle"><i class="fa fa-check"></i><b>8.1</b> The hydrologic cycle</a></li>
<li class="chapter" data-level="8.2" data-path="the-hydrologic-cycle-and-precipitation.html"><a href="the-hydrologic-cycle-and-precipitation.html#precipitation-observations"><i class="fa fa-check"></i><b>8.2</b> Precipitation observations</a></li>
<li class="chapter" data-level="8.3" data-path="the-hydrologic-cycle-and-precipitation.html"><a href="the-hydrologic-cycle-and-precipitation.html#precip-freq"><i class="fa fa-check"></i><b>8.3</b> Precipitation frequency</a></li>
<li class="chapter" data-level="8.4" data-path="the-hydrologic-cycle-and-precipitation.html"><a href="the-hydrologic-cycle-and-precipitation.html#precipitation-gauge-consistency-double-mass-curves"><i class="fa fa-check"></i><b>8.4</b> Precipitation gauge consistency – double mass curves</a></li>
<li class="chapter" data-level="8.5" data-path="the-hydrologic-cycle-and-precipitation.html"><a href="the-hydrologic-cycle-and-precipitation.html#precipitation-interpolation-and-areal-averaging"><i class="fa fa-check"></i><b>8.5</b> Precipitation interpolation and areal averaging</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html"><i class="fa fa-check"></i><b>9</b> Fate of precipitation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#interception"><i class="fa fa-check"></i><b>9.1</b> Interception</a></li>
<li class="chapter" data-level="9.2" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#infiltration"><i class="fa fa-check"></i><b>9.2</b> Infiltration</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#horton-infiltration-equation"><i class="fa fa-check"></i><b>9.2.1</b> Horton infiltration equation</a></li>
<li class="chapter" data-level="9.2.2" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#green-ampt-infiltration-model"><i class="fa fa-check"></i><b>9.2.2</b> Green-Ampt infiltration model</a></li>
<li class="chapter" data-level="9.2.3" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#the-nrcs-method"><i class="fa fa-check"></i><b>9.2.3</b> The NRCS method</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#evaporation"><i class="fa fa-check"></i><b>9.3</b> Evaporation</a></li>
<li class="chapter" data-level="9.4" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#snow"><i class="fa fa-check"></i><b>9.4</b> Snow</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#observations"><i class="fa fa-check"></i><b>9.4.1</b> Observations</a></li>
<li class="chapter" data-level="9.4.2" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#basic-snowmelt-theory-and-simple-models"><i class="fa fa-check"></i><b>9.4.2</b> Basic snowmelt theory and simple models</a></li>
<li class="chapter" data-level="9.4.3" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#snow-model-calibration"><i class="fa fa-check"></i><b>9.4.3</b> Snow model calibration</a></li>
<li class="chapter" data-level="9.4.4" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#estimating-climate-change-impacts-on-snow"><i class="fa fa-check"></i><b>9.4.4</b> Estimating climate change impacts on snow</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="fate-of-precipitation.html"><a href="fate-of-precipitation.html#watershed-analysis"><i class="fa fa-check"></i><b>9.5</b> Watershed analysis</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html"><i class="fa fa-check"></i><b>10</b> Designing for floods: flood hydrology</a>
<ul>
<li class="chapter" data-level="10.1" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#engineering-design-requires-probability-and-statistics"><i class="fa fa-check"></i><b>10.1</b> Engineering design requires probability and statistics</a></li>
<li class="chapter" data-level="10.2" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#ffa1"><i class="fa fa-check"></i><b>10.2</b> Estimating floods when you have peak flow observations - flood frequency analysis</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#installing-helpful-packages"><i class="fa fa-check"></i><b>10.2.1</b> Installing helpful packages</a></li>
<li class="chapter" data-level="10.2.2" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#download-manipulate-and-plot-the-data-for-a-site"><i class="fa fa-check"></i><b>10.2.2</b> Download, manipulate, and plot the data for a site</a></li>
<li class="chapter" data-level="10.2.3" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#flood-frequency-analysis"><i class="fa fa-check"></i><b>10.2.3</b> Flood frequency analysis</a></li>
<li class="chapter" data-level="10.2.4" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#creating-a-flood-frequency-plot"><i class="fa fa-check"></i><b>10.2.4</b> Creating a flood frequency plot</a></li>
<li class="chapter" data-level="10.2.5" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#other-software-for-peak-flow-analysis"><i class="fa fa-check"></i><b>10.2.5</b> Other software for peak flow analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="designing-for-floods-flood-hydrology.html"><a href="designing-for-floods-flood-hydrology.html#estimating-floods-from-precipitation"><i class="fa fa-check"></i><b>10.3</b> Estimating floods from precipitation</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html"><i class="fa fa-check"></i><b>11</b> Sustainability in design: planning for change</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#perturbing-a-system"><i class="fa fa-check"></i><b>11.1</b> Perturbing a system</a></li>
<li class="chapter" data-level="11.2" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#detecting-changes-in-hydrologic-data"><i class="fa fa-check"></i><b>11.2</b> Detecting changes in hydrologic data</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#detecting-a-step-change"><i class="fa fa-check"></i><b>11.2.1</b> Detecting a step change</a></li>
<li class="chapter" data-level="11.2.2" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#detecting-a-monotonic-trend"><i class="fa fa-check"></i><b>11.2.2</b> Detecting a monotonic trend</a></li>
<li class="chapter" data-level="11.2.3" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#choosing-whether-to-use-parametric-or-non-parametric-tests"><i class="fa fa-check"></i><b>11.2.3</b> Choosing whether to use parametric or non-parametric tests</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#detecting-changes-in-extreme-events"><i class="fa fa-check"></i><b>11.3</b> Detecting changes in extreme events</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#obtaining-and-preparing-sea-level-data"><i class="fa fa-check"></i><b>11.3.1</b> Obtaining and preparing sea-level data</a></li>
<li class="chapter" data-level="11.3.2" data-path="sustainability-in-design-planning-for-change.html"><a href="sustainability-in-design-planning-for-change.html#conducting-the-extreme-event-analysis"><i class="fa fa-check"></i><b>11.3.2</b> Conducting the extreme event analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html"><i class="fa fa-check"></i><b>12</b> Management of water resources systems</a>
<ul>
<li class="chapter" data-level="12.1" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#a-simple-linear-system-with-two-decision-variables"><i class="fa fa-check"></i><b>12.1</b> A simple linear system with two decision variables</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#overview-of-problem-formulation"><i class="fa fa-check"></i><b>12.1.1</b> Overview of problem formulation</a></li>
<li class="chapter" data-level="12.1.2" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#setting-up-an-example"><i class="fa fa-check"></i><b>12.1.2</b> Setting up an example</a></li>
<li class="chapter" data-level="12.1.3" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#graphing-the-solution-space"><i class="fa fa-check"></i><b>12.1.3</b> Graphing the solution space</a></li>
<li class="chapter" data-level="12.1.4" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#setting-up-the-problem-in-r"><i class="fa fa-check"></i><b>12.1.4</b> Setting up the problem in R</a></li>
<li class="chapter" data-level="12.1.5" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#interpreting-the-optimal-results"><i class="fa fa-check"></i><b>12.1.5</b> Interpreting the optimal results</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#more-complex-linear-programming-reservoir-operation"><i class="fa fa-check"></i><b>12.2</b> More complex linear programming: reservoir operation</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#problem-summary"><i class="fa fa-check"></i><b>12.2.1</b> Problem summary</a></li>
<li class="chapter" data-level="12.2.2" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#setting-up-the-problem-in-r-1"><i class="fa fa-check"></i><b>12.2.2</b> Setting up the problem in R</a></li>
<li class="chapter" data-level="12.2.3" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#building-the-linear-model"><i class="fa fa-check"></i><b>12.2.3</b> Building the linear model</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#more-realistic-reservoir-operation-non-linear-programming"><i class="fa fa-check"></i><b>12.3</b> More Realistic Reservoir Operation: non-linear programming</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#reservoir-operation"><i class="fa fa-check"></i><b>12.3.1</b> Reservoir operation</a></li>
<li class="chapter" data-level="12.3.2" data-path="management-of-water-resources-systems.html"><a href="management-of-water-resources-systems.html#performing-stochastic-dynamic-programming"><i class="fa fa-check"></i><b>12.3.2</b> Performing stochastic dynamic programming</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="groundwater.html"><a href="groundwater.html"><i class="fa fa-check"></i><b>13</b> Groundwater</a>
<ul>
<li class="chapter" data-level="13.1" data-path="groundwater.html"><a href="groundwater.html#soil-characteristics"><i class="fa fa-check"></i><b>13.1</b> Soil characteristics</a></li>
<li class="chapter" data-level="13.2" data-path="groundwater.html"><a href="groundwater.html#hydraulic-gradient-and-flow-direction"><i class="fa fa-check"></i><b>13.2</b> Hydraulic gradient and flow direction</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="groundwater.html"><a href="groundwater.html#importing-and-transforming-point-data"><i class="fa fa-check"></i><b>13.2.1</b> Importing and transforming point data</a></li>
<li class="chapter" data-level="13.2.2" data-path="groundwater.html"><a href="groundwater.html#interpolating-points-to-a-regular-grid-using-kriging"><i class="fa fa-check"></i><b>13.2.2</b> Interpolating points to a regular grid (using kriging)</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="groundwater.html"><a href="groundwater.html#groundwater-flow-in-aquifers"><i class="fa fa-check"></i><b>13.3</b> Groundwater flow in aquifers</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="groundwater.html"><a href="groundwater.html#fundamental-equations"><i class="fa fa-check"></i><b>13.3.1</b> Fundamental equations</a></li>
<li class="chapter" data-level="13.3.2" data-path="groundwater.html"><a href="groundwater.html#groundwater-flow-under-steady-state-conditions"><i class="fa fa-check"></i><b>13.3.2</b> Groundwater flow under steady state conditions</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="groundwater.html"><a href="groundwater.html#drawdown-due-to-pumping"><i class="fa fa-check"></i><b>13.4</b> Drawdown due to pumping</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="groundwater.html"><a href="groundwater.html#drawdowns-due-to-well-pumping-under-steady-state-conditions"><i class="fa fa-check"></i><b>13.4.1</b> Drawdowns due to well pumping under steady state conditions</a></li>
<li class="chapter" data-level="13.4.2" data-path="groundwater.html"><a href="groundwater.html#drawdown-due-to-well-pumping-time-varying"><i class="fa fa-check"></i><b>13.4.2</b> Drawdown due to well pumping: time varying</a></li>
<li class="chapter" data-level="13.4.3" data-path="groundwater.html"><a href="groundwater.html#determining-aquifer-characteristics-from-drawdown-observations"><i class="fa fa-check"></i><b>13.4.3</b> Determining aquifer characteristics from drawdown observations</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="groundwater.html"><a href="groundwater.html#remote-sensing-of-groundwater-with-grace"><i class="fa fa-check"></i><b>13.5</b> Remote sensing of groundwater with GRACE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hydraulics and Water Resources: Examples Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fate-of-precipitation" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Fate of precipitation<a href="fate-of-precipitation.html#fate-of-precipitation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>As precipitation falls and can be caught on vegetation (interception), percolate into the ground (infiltration), return to the atmosphere (evaporation), or become available as runoff (if accumulating as rain or snow).
The landscape (land cover and topography) and the time scale of study determine what processes are important. For example, for estimating runoff from an individual storm, interception is likely to be small, as is evaporation. On an annual average over large areas, evaporation will often be the largest component.</p>
<p>Comprehensive hydrology models will estimate abstractions due to infiltration and interception, either by simulating the physics of the phenomenon or by using a lumped parameter that accounts for the effects of abstractions on runoff.</p>
<p>The <em>hydromisc</em> package will need to be installed to access some of the code and data used below. If it is not installed, do so following the instructions on <a href="https://github.com/EdM44/hydromisc">the github site for the package</a>.</p>
<div id="interception" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Interception<a href="fate-of-precipitation.html#interception" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:int-1"></span>
<img src="images/leaf_interception.jpg" alt="Rain interception by John Robert McPherson, CC BY-SA 4, via Wikimedia Commons" width="60%" />
<p class="caption">
Figure 9.1: Rain interception by John Robert McPherson, <a href="https://commons.wikimedia.org/wiki/Category:CC-BY-SA-4.0">CC BY-SA 4</a>, via Wikimedia Commons
</p>
</div>
<p>Interception of rainfall is generally small during individual storms (0.5-2 mm), so it is often ignored, or lumped in with other abstractions, for analyses of flood hydrology. For areas characterized by low intensity rainfall and heavy vegetation, interception can account for a larger portion of the rainfall (for example, up to 25% of annual rainfall in the Pacific Northwest) <span class="citation">(<a href="references.html#ref-mccuen_hydrologic_2016">McCuen, 2016</a>)</span>.</p>
</div>
<div id="infiltration" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Infiltration<a href="fate-of-precipitation.html#infiltration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The movement of water through a saturated soil column is governed by Darcy’s law.
<a href="fate-of-precipitation.html#eq:darcy-a">(9.1)</a>.
<span class="math display" id="eq:darcy-a">\[\begin{equation}
  q~=~ -K\frac{\partial H}{\partial s}
    \tag{9.1}
\end{equation}\]</span>
where <em>q</em> is the flow of water per unit area (L/T), <em>K</em> is the hydraulic conductivity (L/T), <em>H</em> is the hydraulic head (L) and <em>s</em> is the distance along a flow path. Because infiltration into soils often begins with unsaturated conditions, <em>K</em> becomes a function of water content and hydraulic head. The solution becomes complicated, and empirical formulations are used.</p>
<div id="horton-infiltration-equation" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Horton infiltration equation<a href="fate-of-precipitation.html#horton-infiltration-equation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An early empirical equation describing infiltration rate into soils was developed by Horton <span class="citation">(<a href="references.html#ref-horton_re_analysis_1939">Horton, R.E., 1939</a>)</span>, which takes the form of Equation <a href="fate-of-precipitation.html#eq:horton">(9.2)</a>.
<span class="math display" id="eq:horton">\[\begin{equation}
  f_p~=~ f_c + \left(f_0 - f_c\right)e^{-kt}
    \tag{9.2}
\end{equation}\]</span>
This describes a potential infiltration rate, <span class="math inline">\(f_p\)</span>, beginning at a maximum <span class="math inline">\(f_0\)</span> and decreasing with time toward a minimum value <span class="math inline">\(f_c\)</span> at a rate described by the decay constant <span class="math inline">\(k\)</span>. <span class="math inline">\(f_c\)</span> is also equal to the saturated hydraulic conductivity, <span class="math inline">\(K_s\)</span>, of the soil. If rainfall rate exceeds <span class="math inline">\(f_c\)</span> then this equation describes the actual infiltration rate with time. If periods of time have rainfall less intense than <span class="math inline">\(f_c\)</span> it is convenient to integrate this to relate the total cumulative depth of water infiltrated, <span class="math inline">\(F\)</span>, and the actual infiltration rate, <span class="math inline">\(f_p\)</span>, as in Equation <a href="fate-of-precipitation.html#eq:horton2">(9.3)</a>.
<span class="math display" id="eq:horton2">\[\begin{equation}
  F~=~\left[\frac{f_c}{k}ln\left(f_0-f_c\right)+\frac{f_0}{k}\right]-\frac{f_c}{k}ln\left(f_p-f_c\right)-\frac{f_p}{k}
    \tag{9.3}
\end{equation}\]</span></p>
<p>Parameters for the Horton, Green-Ampt, and other infiltration models can be derived from observed infiltration data using the R package <a href="https://CRAN.R-project.org/package=HydroMe">HydroMe</a>. Fitting the Horton equation to observed data is demonstrated here using a small sample from the <em>infilt</em> data set included with the <code>HydroMe</code> package which is saved in a spreadsheet wrapped into the <code>hydromisc</code> package. While <code>HydroMe</code> includes a function to return parameters, this can also be done manually as shown here.</p>
<div class="example">
<p><span id="exm:ex-infilt1" class="example"><strong>Example 9.1  </strong></span>Fit a Horton infiltration model to measured infiltration data, then use the derived parameters to plot the infiltration rate over time.</p>
</div>
<p>First, for this example, read in the data sample included with the <code>hydromisc</code> package.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="fate-of-precipitation.html#cb98-1" tabindex="-1"></a><span class="co"># path to sample spreadsheet</span></span>
<span id="cb98-2"><a href="fate-of-precipitation.html#cb98-2" tabindex="-1"></a>datafile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;infilt_field_data.xlsx&quot;</span>, <span class="at">package=</span><span class="st">&quot;hydromisc&quot;</span>)</span>
<span id="cb98-3"><a href="fate-of-precipitation.html#cb98-3" tabindex="-1"></a>infilt_data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(datafile)</span></code></pre></div>
<p>Set up a function for the Horton equation and use the built in <code>stats</code> package function <code>nls</code> to solve for the parameters. This works with column names of ‘Time’ and ‘Rate’ (case sensitive).</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="fate-of-precipitation.html#cb99-1" tabindex="-1"></a>horton <span class="ot">&lt;-</span> <span class="cf">function</span>(time, fc, f0, k) {</span>
<span id="cb99-2"><a href="fate-of-precipitation.html#cb99-2" tabindex="-1"></a>  fc <span class="sc">+</span> (f0 <span class="sc">-</span> fc) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> time)</span>
<span id="cb99-3"><a href="fate-of-precipitation.html#cb99-3" tabindex="-1"></a>}</span>
<span id="cb99-4"><a href="fate-of-precipitation.html#cb99-4" tabindex="-1"></a>horton_fit <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">nls</span>(Rate <span class="sc">~</span> <span class="fu">horton</span>(Time, fc, f0, k), <span class="at">data =</span> infilt_data, </span>
<span id="cb99-5"><a href="fate-of-precipitation.html#cb99-5" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">fc=</span><span class="fl">0.2</span>, <span class="at">f0=</span><span class="dv">1</span>, <span class="at">k=</span><span class="fl">0.1</span>))</span>
<span id="cb99-6"><a href="fate-of-precipitation.html#cb99-6" tabindex="-1"></a><span class="fu">coef</span>(horton_fit)</span>
<span id="cb99-7"><a href="fate-of-precipitation.html#cb99-7" tabindex="-1"></a><span class="co">#&gt;         fc         f0          k </span></span>
<span id="cb99-8"><a href="fate-of-precipitation.html#cb99-8" tabindex="-1"></a><span class="co">#&gt; 0.52816667 1.25076318 0.05102829</span></span></code></pre></div>
<p>Using poor guesses as starting values can result in error messages like ‘singular gradient’ indicating the <code>nls</code> function could not find a solution. Trying better guesses for starting parameter values can help: <span class="math inline">\(f_c\)</span> should be close to the final infiltration rate observed, and <span class="math inline">\(f_0\)</span> near the initial rate. Another approach is illustrated below.</p>
<p>Plot the results of the fit with the observations.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="fate-of-precipitation.html#cb100-1" tabindex="-1"></a>infilt_data<span class="sc">$</span>Rate_Horton <span class="ot">&lt;-</span> <span class="fu">predict</span>(horton_fit, <span class="fu">list</span>(<span class="at">x =</span> infilt_data<span class="sc">$</span>Time))</span>
<span id="cb100-2"><a href="fate-of-precipitation.html#cb100-2" tabindex="-1"></a><span class="fu">plot</span>(infilt_data<span class="sc">$</span>Time,infilt_data<span class="sc">$</span>Rate, <span class="at">pch=</span><span class="dv">1</span>, </span>
<span id="cb100-3"><a href="fate-of-precipitation.html#cb100-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time, min&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Infiltration rate, cm/hr&quot;</span>)</span>
<span id="cb100-4"><a href="fate-of-precipitation.html#cb100-4" tabindex="-1"></a><span class="fu">lines</span>(infilt_data<span class="sc">$</span>Time, infilt_data<span class="sc">$</span>Rate_Horton, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb100-5"><a href="fate-of-precipitation.html#cb100-5" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Obs.&quot;</span>,<span class="st">&quot;Horton&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:horton-3"></span>
<img src="hydr-watres_main_files/figure-html/horton-3-1.png" alt="A Horton infiltration curve fit to experimental observations." width="60%" />
<p class="caption">
Figure 9.2: A Horton infiltration curve fit to experimental observations.
</p>
</div>
<p>Using the <a href="https://cran.r-project.org/package=nlsr">nlsr</a> package provides a similar function to <code>nls</code> that can accommodate much worse starting parameter values. Using the starting values below in the <code>nls</code> command above fails. The use of <code>nlsr</code> functions is slightly different from <code>nls</code>, as shown below.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="fate-of-precipitation.html#cb101-1" tabindex="-1"></a>horton_form <span class="ot">&lt;-</span> Rate <span class="sc">~</span> fc <span class="sc">+</span> (f0 <span class="sc">-</span> fc) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> Time)</span>
<span id="cb101-2"><a href="fate-of-precipitation.html#cb101-2" tabindex="-1"></a>horton_fit2 <span class="ot">&lt;-</span> nlsr<span class="sc">::</span><span class="fu">nlxb</span>(<span class="at">formula =</span> horton_form, <span class="at">data =</span> infilt_data, </span>
<span id="cb101-3"><a href="fate-of-precipitation.html#cb101-3" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">fc=</span><span class="dv">1</span>, <span class="at">f0=</span><span class="dv">1</span>, <span class="at">k=</span><span class="fl">0.5</span>))</span>
<span id="cb101-4"><a href="fate-of-precipitation.html#cb101-4" tabindex="-1"></a>predicted_values <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(horton_fit2, <span class="fu">list</span>(<span class="at">Time =</span> infilt_data<span class="sc">$</span>Time)))</span>
<span id="cb101-5"><a href="fate-of-precipitation.html#cb101-5" tabindex="-1"></a>horton_fit2<span class="sc">$</span>coefficients</span>
<span id="cb101-6"><a href="fate-of-precipitation.html#cb101-6" tabindex="-1"></a><span class="co">#&gt;        fc        f0         k </span></span>
<span id="cb101-7"><a href="fate-of-precipitation.html#cb101-7" tabindex="-1"></a><span class="co">#&gt; 0.5281621 1.2507571 0.0510268</span></span></code></pre></div>
</div>
<div id="green-ampt-infiltration-model" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Green-Ampt infiltration model<a href="fate-of-precipitation.html#green-ampt-infiltration-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A more physically based relationship to describe infiltration rate is the Green-Ampt model <span class="citation">(<a href="references.html#ref-green_h_studies_1911">Green &amp; Ampt, 1911</a>)</span>. It is based on the physical laws describing the propogation of a wetting front downward through a soil column under a ponded water surface. The Green-Ampt relationship is expressed either in terms of infiltration rate, <span class="math inline">\(f_p\)</span> or cumulative infiltration, <em>F</em>, as in Equations <a href="fate-of-precipitation.html#eq:GA1">(9.4)</a> and <a href="fate-of-precipitation.html#eq:GA2">(9.5)</a>.
<span class="math display" id="eq:GA1">\[\begin{equation}
  f_p~=~K_s\left[1~+~\frac{\Delta\theta~\Psi_f}{F}\right]
    \tag{9.4}
\end{equation}\]</span>
<span class="math inline">\(\Delta\theta=\left(n-\theta_i\right)\)</span> where <em>n</em> is effective porosity and <span class="math inline">\(\theta\)</span> is the initial water content. <span class="math inline">\(\Psi\)</span> is the capillary potential or wetting front suction head.
<span class="math display" id="eq:GA2">\[\begin{equation}
  K_st~=~F-\left(n-\theta_i\right)\Psi_f~ln\left[1+\frac{F}{\left(n-\theta_i\right)\Psi_f}\right] ~=~ F-N_s~ln\left[1+\frac{F}{N_s}\right]
    \tag{9.5}
\end{equation}\]</span>
The parameter <span class="math inline">\(N_s=\left(n-\theta_i\right)\Psi_f\)</span> is referred to as the matric potential. Different references use different symbols for these terms. These equations assume ponding begins at t=0, meaning rainfall rate exceeds <span class="math inline">\(K_s\)</span>. When rainfall rates are less than that, adjustments to the method are used. Typical parameter values are shown in the table below.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:infilt-1"></span>
<img src="images/soil_parameters.png" alt="Green-Ampt Parameter Estimates and Ranges based on Soil Texture USACE" width="90%" />
<p class="caption">
Figure 9.3: Green-Ampt Parameter Estimates and Ranges based on Soil Texture <a href="https://www.hec.usace.army.mil/confluence/rasdocs/ras1dtechref/6.1/overview-of-optional-capabilities/modeling-precipitation-and-infiltration/green-ampt">USACE</a>
</p>
</div>
<div class="example">
<p><span id="exm:ex-infilt2" class="example"><strong>Example 9.2  </strong></span>Fit a Green-Ampt infiltration model to measured infiltration data, then use the derived parameters to plot the infiltration rate over time.</p>
</div>
<p>For convenience, this uses the same infiltration data as in the prior example. Because the Green-Ampt formulation needs cumulative infiltration depth, <em>F</em>, first create a column of this in the data frame.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="fate-of-precipitation.html#cb102-1" tabindex="-1"></a><span class="co"># Add a column for incremental time</span></span>
<span id="cb102-2"><a href="fate-of-precipitation.html#cb102-2" tabindex="-1"></a>infilt_data <span class="ot">&lt;-</span> infilt_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">dt =</span> Time <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(Time))</span>
<span id="cb102-3"><a href="fate-of-precipitation.html#cb102-3" tabindex="-1"></a><span class="co"># Add value to first row</span></span>
<span id="cb102-4"><a href="fate-of-precipitation.html#cb102-4" tabindex="-1"></a>infilt_data<span class="sc">$</span>dt[<span class="dv">1</span>] <span class="ot">&lt;-</span> infilt_data<span class="sc">$</span>Time[<span class="dv">1</span>]</span>
<span id="cb102-5"><a href="fate-of-precipitation.html#cb102-5" tabindex="-1"></a><span class="co"># Add a column for cumulative infiltration</span></span>
<span id="cb102-6"><a href="fate-of-precipitation.html#cb102-6" tabindex="-1"></a>infilt_data<span class="sc">$</span>Cumul_Infilt <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(infilt_data<span class="sc">$</span>Rate <span class="sc">*</span> infilt_data<span class="sc">$</span>dt)</span></code></pre></div>
<p>Because the Green-Ampt model comprises implicit, nonlinear equations they cannot be solved directly, as could be done with the Horton equation. Combining the base <code>uniroot</code> function for solving an implicit equation with the non-linear fitting capabilities of the Flexible Modelling Environment <a href="https://cran.r-project.org/package=FME">FME</a> package makes this possible in <em>R</em>.</p>
<p>First, define a function that finds cumulative infiltration, <em>Fp</em>, for a given time and the Green-Ampt parameters <em>K</em> and <em>Ns</em> in <a href="fate-of-precipitation.html#eq:GA2">(9.5)</a> (rearranged to solve for zero).</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="fate-of-precipitation.html#cb103-1" tabindex="-1"></a>GA_infilt <span class="ot">&lt;-</span> <span class="cf">function</span>(time, parms) {</span>
<span id="cb103-2"><a href="fate-of-precipitation.html#cb103-2" tabindex="-1"></a>    <span class="fu">with</span>(<span class="fu">as.list</span>(parms), {</span>
<span id="cb103-3"><a href="fate-of-precipitation.html#cb103-3" tabindex="-1"></a>      <span class="co"># function to solve for zero</span></span>
<span id="cb103-4"><a href="fate-of-precipitation.html#cb103-4" tabindex="-1"></a>      <span class="fu">uniroot</span>(<span class="cf">function</span>(Fp) Fp <span class="sc">-</span> K<span class="sc">*</span>time <span class="sc">-</span> Ns <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> Fp<span class="sc">/</span>Ns), </span>
<span id="cb103-5"><a href="fate-of-precipitation.html#cb103-5" tabindex="-1"></a>              <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1e3</span>),</span>
<span id="cb103-6"><a href="fate-of-precipitation.html#cb103-6" tabindex="-1"></a>              <span class="at">tol =</span> <span class="dv">1</span>.e<span class="dv">-6</span>)<span class="sc">$</span>root</span>
<span id="cb103-7"><a href="fate-of-precipitation.html#cb103-7" tabindex="-1"></a>    })</span>
<span id="cb103-8"><a href="fate-of-precipitation.html#cb103-8" tabindex="-1"></a>  }</span></code></pre></div>
<p>Now set up the function to optimize the parameters for all times, with the goal to minimize the square root of the squared differences. Any other function could be used to minimize the difference by changing the last line of the function. Then use the <code>FME</code> <code>modFit</code> function to find the optimal parameters.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="fate-of-precipitation.html#cb104-1" tabindex="-1"></a>GA_min <span class="ot">&lt;-</span> <span class="cf">function</span>(ps) {</span>
<span id="cb104-2"><a href="fate-of-precipitation.html#cb104-2" tabindex="-1"></a>  K <span class="ot">&lt;-</span> ps[<span class="dv">1</span>]</span>
<span id="cb104-3"><a href="fate-of-precipitation.html#cb104-3" tabindex="-1"></a>  Ns <span class="ot">&lt;-</span> ps[<span class="dv">2</span>]</span>
<span id="cb104-4"><a href="fate-of-precipitation.html#cb104-4" tabindex="-1"></a>  GA_fit <span class="ot">&lt;-</span> <span class="fu">sapply</span>(infilt_data<span class="sc">$</span>Time, GA_infilt, <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">K =</span> K, <span class="at">Ns =</span> Ns))</span>
<span id="cb104-5"><a href="fate-of-precipitation.html#cb104-5" tabindex="-1"></a>  <span class="fu">sqrt</span>((GA_fit <span class="sc">-</span> infilt_data<span class="sc">$</span>Cumul_Infilt)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb104-6"><a href="fate-of-precipitation.html#cb104-6" tabindex="-1"></a>}</span>
<span id="cb104-7"><a href="fate-of-precipitation.html#cb104-7" tabindex="-1"></a></span>
<span id="cb104-8"><a href="fate-of-precipitation.html#cb104-8" tabindex="-1"></a><span class="co">#Set initial parameter values and run minimization function for the best parameter set</span></span>
<span id="cb104-9"><a href="fate-of-precipitation.html#cb104-9" tabindex="-1"></a>parms_start <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb104-10"><a href="fate-of-precipitation.html#cb104-10" tabindex="-1"></a>GA_out <span class="ot">&lt;-</span> FME<span class="sc">::</span><span class="fu">modFit</span>(<span class="at">f =</span> GA_min, <span class="at">p =</span> parms_start, <span class="at">lower =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb104-11"><a href="fate-of-precipitation.html#cb104-11" tabindex="-1"></a>                  <span class="at">upper =</span> <span class="fu">c</span>(<span class="cn">Inf</span>, <span class="cn">Inf</span>))</span>
<span id="cb104-12"><a href="fate-of-precipitation.html#cb104-12" tabindex="-1"></a>fitted_parms <span class="ot">&lt;-</span> <span class="fu">setNames</span>(GA_out<span class="sc">$</span>par, <span class="fu">c</span>(<span class="st">&quot;K&quot;</span>,<span class="st">&quot;Ns&quot;</span>))</span>
<span id="cb104-13"><a href="fate-of-precipitation.html#cb104-13" tabindex="-1"></a>fitted_parms</span>
<span id="cb104-14"><a href="fate-of-precipitation.html#cb104-14" tabindex="-1"></a><span class="co">#&gt;         K        Ns </span></span>
<span id="cb104-15"><a href="fate-of-precipitation.html#cb104-15" tabindex="-1"></a><span class="co">#&gt; 0.5656739 4.8610322</span></span></code></pre></div>
<p>Finally, use the best fit parameters to generate a sequence of cumulative infiltration values using <a href="fate-of-precipitation.html#eq:GA2">(9.5)</a> and infiltration rate using <a href="fate-of-precipitation.html#eq:GA1">(9.4)</a>, plotting the results along with the constant rate (average) infiltration for the observation period.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="fate-of-precipitation.html#cb105-1" tabindex="-1"></a>fitted_F <span class="ot">&lt;-</span> <span class="fu">sapply</span>(infilt_data<span class="sc">$</span>Time, GA_infilt, <span class="at">parms =</span> fitted_parms)</span>
<span id="cb105-2"><a href="fate-of-precipitation.html#cb105-2" tabindex="-1"></a>infilt_data<span class="sc">$</span>Rate_GA <span class="ot">&lt;-</span> fitted_parms[[<span class="st">&#39;K&#39;</span>]] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> fitted_parms[[<span class="st">&#39;Ns&#39;</span>]]<span class="sc">/</span>fitted_F)</span>
<span id="cb105-3"><a href="fate-of-precipitation.html#cb105-3" tabindex="-1"></a></span>
<span id="cb105-4"><a href="fate-of-precipitation.html#cb105-4" tabindex="-1"></a><span class="co"># Make a plot</span></span>
<span id="cb105-5"><a href="fate-of-precipitation.html#cb105-5" tabindex="-1"></a><span class="fu">plot</span>(infilt_data<span class="sc">$</span>Time,infilt_data<span class="sc">$</span>Rate, <span class="at">pch=</span><span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">&quot;Time, min&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Infiltration rate, cm/hr&quot;</span>)</span>
<span id="cb105-6"><a href="fate-of-precipitation.html#cb105-6" tabindex="-1"></a><span class="fu">lines</span>(infilt_data<span class="sc">$</span>Time, infilt_data<span class="sc">$</span>Rate_GA, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb105-7"><a href="fate-of-precipitation.html#cb105-7" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">tail</span>(infilt_data<span class="sc">$</span>Cumul_Infilt, <span class="dv">1</span>)<span class="sc">/</span><span class="fu">tail</span>(infilt_data<span class="sc">$</span>Time, <span class="dv">1</span>))</span>
<span id="cb105-8"><a href="fate-of-precipitation.html#cb105-8" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Obs.&quot;</span>,<span class="st">&quot;Green-Ampt&quot;</span>,<span class="st">&quot;Constant&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:GA-4"></span>
<img src="hydr-watres_main_files/figure-html/GA-4-1.png" alt="A Green-Ampt curve fit, with the average constant rate." width="60%" />
<p class="caption">
Figure 9.4: A Green-Ampt curve fit, with the average constant rate.
</p>
</div>
</div>
<div id="the-nrcs-method" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> The NRCS method<a href="fate-of-precipitation.html#the-nrcs-method" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The most widely used method for estimating infiltration is the NRCS method, described in detail in the NRCS document <a href="https://directives.sc.egov.usda.gov/46253.wba">Estimating Runoff Volume and Peak Discharge</a>.This method describes the direct runoff (as a depth), <span class="math inline">\(Q\)</span>, resulting from a precipitation event, <span class="math inline">\(P\)</span>, as in Equation <a href="fate-of-precipitation.html#eq:NRCS1">(9.6)</a>.
<span class="math display" id="eq:NRCS1">\[\begin{equation}
  Q~=~\frac{\left(P-I_a\right)^2}{\left(P-I_a\right)+S}
    \tag{9.6}
\end{equation}\]</span>
<span class="math inline">\(S\)</span> is the maximum retention of water by the soil column and <span class="math inline">\(I_a\)</span> is the initial abstraction, commonly estimated as <span class="math inline">\(I_a=0.2S\)</span>. Substituting this into Equation <a href="fate-of-precipitation.html#eq:NRCS1">(9.6)</a> produces Equation <a href="fate-of-precipitation.html#eq:NRCS2">(9.7)</a>.
<span class="math display" id="eq:NRCS2">\[\begin{equation}
  Q~=~\frac{\left(P-0.2~S\right)^2}{\left(P+0.8~S\right)}
    \tag{9.7}
\end{equation}\]</span>
This relationship applies as long as <span class="math inline">\(P&gt;0.2~S\)</span>; Q=0 otherwise. Values for S are derived from a Curve Number (CN), which summarizes the land cover, soil type and condition: <span class="math display">\[CN=\frac{1000}{10+S}\]</span>
where <span class="math inline">\(S\)</span>, and subsequently <span class="math inline">\(Q\)</span>, are in inches. Equation <a href="fate-of-precipitation.html#eq:NRCS2">(9.7)</a> can be rearranged to a form similar to those for the Horton and Green-Ampt equations for cumulative infiltration, <span class="math inline">\(F\)</span>. <span class="math display">\[F~=~\frac{\left(P-0.2~S\right)S}{P+0.8~S}\]</span>.</p>
</div>
</div>
<div id="evaporation" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Evaporation<a href="fate-of-precipitation.html#evaporation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Evaporation is simply the change of water from liquid to vapor state. Because it is difficult to separate evaporation from the soil from transpiration from vegetation, it is usually combined into Evapotranspiration, or ET; see Figure <a href="fate-of-precipitation.html#fig:et-1">9.5</a>.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:et-1"></span>
<img src="images/eto_overview.gif" alt="Schematic of ET, from CIMIS" width="35%" />
<p class="caption">
Figure 9.5: Schematic of ET, from <a href="https://cimis.water.ca.gov">CIMIS</a>
</p>
</div>
<p>ET can be estimated in a variety of ways, but it is important first to define three types of ET:
- Potential ET, <span class="math inline">\(ET_p\)</span> or <span class="math inline">\(PET\)</span>: essentially the same as the rate that water would evaporate from a free water surface.
- Reference crop ET, <span class="math inline">\(ET_{ref}\)</span> or <span class="math inline">\(ET_0\)</span>: the rate water evaporates from a well-watered reference crop, usually grass of a standard height.
- Actual ET, <span class="math inline">\(ET\)</span>: this is the water used by a crop or other vegetation, usually calculated by adjusting the <span class="math inline">\(ET_0\)</span> term by a crop coefficient that accounts for factors such as the plant height, growth stage, and soil exposure.</p>
<p>Estimating <span class="math inline">\(ET_0\)</span> can be as uncomplicated as using the Thornthwaite equation, which depends only on mean monthly temperatures, to the Penman-Monteith equation, which includes solar and longwave radiation, wind and humidity effects, and reference crop (grass) characteristics. Inclusion of more complexity, especially where observations can supply the needed input, produces more reliable estimates of <span class="math inline">\(ET_0\)</span>.One of the most common implementations of the Penman-Monteith equation is the version of the FAO (<a href="https://www.fao.org/3/X0490E/x0490e00.htm">FAO Irrigation and drainage paper 56</a>, or FAO56) <span class="citation">(<a href="references.html#ref-allen_crop_1998">Allen &amp; United Nations, 1998</a>)</span>. Refer to FAO56 for step-by-step instructions on determining each term in the Penman-Monteith equation, Equation <a href="fate-of-precipitation.html#eq:pm1">(9.8)</a>.
<span class="math display" id="eq:pm1">\[\begin{equation}
  \lambda~ET~=~\frac{\Delta\left(R_n-G\right)+\rho_ac_p\frac{\left(e_s-e_a\right)}{r_a}}{\Delta+\gamma\left(1+\frac{r_s}{r_a}\right)}
    \tag{9.8}
\end{equation}\]</span></p>
<p>Open water evaporation can be calculated using the original Penman equation (1948):
<span class="math display">\[\lambda~E_p~=~\frac{\Delta~R_n+\gamma~E_a}{\Delta~+~\gamma}\]</span>
where <span class="math inline">\(R_n\)</span> is the net radiation available to evaporate water and <span class="math inline">\(E_a\)</span> is a mass transfer function usually including humidity (or vapor pressure deficit) and wind speed. <span class="math inline">\(\lambda\)</span> is the latent heat of vaporization of water. A common implementation of the Penman equation is
<span class="math display" id="eq:pm2">\[\begin{equation}
  \lambda~E_p~=~\frac{\Delta~R_n+\gamma~6.43\left(1+0.536~U_2\right)\left(e_s-e\right)}{\Delta~+~\gamma}
    \tag{9.9}
\end{equation}\]</span>
Here <span class="math inline">\(E_p\)</span> is in mm/d, <span class="math inline">\(\Delta\)</span> and <span class="math inline">\(\gamma\)</span> are in <span class="math inline">\(kPa~K^{-1}\)</span>, <span class="math inline">\(R_n\)</span> is in <span class="math inline">\(MJ~m^{−2}~d^{−1}\)</span>, <span class="math inline">\(U_2\)</span> is in m/s, and <span class="math inline">\(e_s\)</span> and <span class="math inline">\(e\)</span> are in kPa. Variables are as defined in FAO56.</p>
<p>Open water evaporation can also be calculated using a modified version of the Penman-Monteith equation <a href="fate-of-precipitation.html#eq:pm1">(9.8)</a>. In this latter case, vegetation coefficients are not needed, so Equation <a href="fate-of-precipitation.html#eq:pm1">(9.8)</a> can be used with <span class="math inline">\(r_s=0\)</span> and <span class="math inline">\(r_a=251/(1+0.536~u_2)\)</span>, following <a href="https://doi.org/10.1002/qj.49710343610">Thom &amp; Oliver, 1977</a>.</p>
<p>The R package <a href="https://cran.r-project.org/package=Evapotranspiration">Evaporation</a> has functions to calculate <span class="math inline">\(ET_0\)</span> using this and many other functions. This is especially useful when calculating PET over many points or through a long time series. Satellite-observed ET has been estimated globally as part of the <a href="https://etdata.org/">OpenET project</a>; the data may be accessed using the <a href="https://github.com/codeswitching/openet">openet R package</a>.</p>
</div>
<div id="snow" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Snow<a href="fate-of-precipitation.html#snow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="observations" class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Observations<a href="fate-of-precipitation.html#observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In mountainous areas a substantial portion of the precipitation may fall as snow, where it can be stored for months before melting and becoming runoff. Any hydrologic analysis in an area affected by snow must account for the dynamics of this natural reservoir and how it affects water supply. In the Western U.S., the most comprehensive observations of snow are part of the <a href="https://www.nrcs.usda.gov/wps/portal/wcc/home/">SNOTEL</a> (SNOw TELemetry) network.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:snow-1"></span>
<img src="images/snotel_stations.png" alt="The SNOTEL network." width="50%" />
<p class="caption">
Figure 9.6: The SNOTEL network.
</p>
</div>
</div>
<div id="basic-snowmelt-theory-and-simple-models" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Basic snowmelt theory and simple models<a href="fate-of-precipitation.html#basic-snowmelt-theory-and-simple-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For snow to melt, heat must be added to first bring the snowpack to the melting point; it takes about 2 kJ/kg to increase snowpack temperature 1<span class="math inline">\(^\circ\)</span>C. Additional heat is required for the phase change from ice to water (the latent heat of fusion), about 335 kJ/kg. Heat can be provided by absorbing solar radiation, longwave radiation, ground heat, warm air, warm rain falling on the snowpack or water vapor condensing on the snow. Once snow melts, it can percolate through the snowpack and be retained, similar to water retained by soil, and may re-freeze (releasing the latent heat of fusion, which can then cause more melt).</p>
<p>As with any other hydrologic process, there are many ways it can be modeled, from simplified empirical relationships to complex physics-based representations. While accounting for all of the many processes involved would be a robust approach, often there are not adequate observations to support their use so simpler parameterization are used. Here only the simplest index-based snow model is discussed, as in Equation <a href="fate-of-precipitation.html#eq:snow1">(9.10)</a>.
<span class="math display" id="eq:snow1">\[\begin{equation}
  M~=~K_d\left(T_a~-~T_b\right)
    \tag{9.10}
\end{equation}\]</span>
M is the melt rate in mm/d (or in/day), <span class="math inline">\(T_a\)</span> is air temperature (sometimes a daily mean, sometimes a daily maximum), <span class="math inline">\(T_b\)</span> is a base temperature, usually 0<span class="math inline">\(^\circ\)</span>C (or 32<span class="math inline">\(^\circ\)</span>F), and <span class="math inline">\(K_d\)</span> is a degree-day melt factor in mm/d/<span class="math inline">\(^\circ\)</span>C (or in/d/<span class="math inline">\(^\circ\)</span>F). The melt factor, <span class="math inline">\(K_d\)</span>, is highly dependent on local conditions and on the time of year (as an indicator of the snow pack condition); different <span class="math inline">\(K_d\)</span> factors can be used for different months for example.</p>
<p>Refreezing of melted snow, when temperatures are below <span class="math inline">\(T_b\)</span>, can also be estimated using an index model, such as Equation <a href="fate-of-precipitation.html#eq:snow2">(9.11)</a>.
<span class="math display" id="eq:snow2">\[\begin{equation}
  Fr~=~K_f\left(T_b~-~T_a\right)
    \tag{9.11}
\end{equation}\]</span></p>
<p>Importantly, temperature-index snowmelt relations have been developed primarily for describing snowmelt at the end of season, after the peak of snow accumulation (typically April-May in the mountainous western U.S.), and their use during the snow accumulation season may overestimate melt. Different degree-day factors are often used, with the factors increasing later in the melt season.</p>
<p>From a hydrologic perspective, the most important snow quality is the snow water equivalent (SWE), which is the depth of water obtained by melting the snow. An example of using a snowmelt index model follows.</p>
<div class="example">
<p><span id="exm:ex-snow1" class="example"><strong>Example 9.3  </strong></span>Manually calibrate an index snowmelt model for a SNOTEL site using one year of data.</p>
</div>
<p>Visit the <a href="https://www.nrcs.usda.gov/wps/portal/wcc/home/">SNOTEL</a> to select a site. In this example site 1050, Horse Meadow, located in California, is used. Next download the data using the <a href="https://cran.r-project.org/package=snotelr">snotelr</a> package (install the package first, if needed).</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="fate-of-precipitation.html#cb106-1" tabindex="-1"></a>sta <span class="ot">&lt;-</span> <span class="st">&quot;1050&quot;</span></span>
<span id="cb106-2"><a href="fate-of-precipitation.html#cb106-2" tabindex="-1"></a>snow_data <span class="ot">&lt;-</span> snotelr<span class="sc">::</span><span class="fu">snotel_download</span>(<span class="at">site_id =</span> sta, <span class="at">internal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Plot the data to assess the period available and how complete it is.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="fate-of-precipitation.html#cb107-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.Date</span>(snow_data<span class="sc">$</span>date), snow_data<span class="sc">$</span>snow_water_equivalent,</span>
<span id="cb107-2"><a href="fate-of-precipitation.html#cb107-2" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SWE (mm)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sno-2"></span>
<img src="hydr-watres_main_files/figure-html/sno-2-1.png" alt="Snow water equivalent at SNOTEL site 1050." width="80%" />
<p class="caption">
Figure 9.7: Snow water equivalent at SNOTEL site 1050.
</p>
</div>
<p>Note the units are SI. If you download data directly from the SNOTEL web site the data would be in conventional US units. <a href="https://cran.r-project.org/package=snotelr">snotelr</a> converts the data to SI units as it imports. The package includes a function <code>snotel_metric</code> that could be used to convert raw data downloaded from the SNOTEL website to SI units.</p>
<p>For this example, we will extract a single year, but set the dates to ensure the entire snow season is contained within a year. The <code>snotel_phenology</code> function makes this easy. By default it uses an offset of 180 days (so years begin 180 days before Jan 1) to accomplish this.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="fate-of-precipitation.html#cb108-1" tabindex="-1"></a>phenology <span class="ot">&lt;-</span> snotelr<span class="sc">::</span><span class="fu">snotel_phenology</span>(snow_data) <span class="co"># Key dates from the observed snow data</span></span>
<span id="cb108-2"><a href="fate-of-precipitation.html#cb108-2" tabindex="-1"></a><span class="fu">min</span>(phenology<span class="sc">$</span>first_snow_acc)                     <span class="co"># Earliest snow accumulation in the record</span></span>
<span id="cb108-3"><a href="fate-of-precipitation.html#cb108-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2004-09-20&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="fate-of-precipitation.html#cb109-1" tabindex="-1"></a><span class="fu">max</span>(phenology<span class="sc">$</span>last_snow_melt)                     <span class="co"># Latest snow melt in the record</span></span>
<span id="cb109-2"><a href="fate-of-precipitation.html#cb109-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2022-05-13&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="fate-of-precipitation.html#cb110-1" tabindex="-1"></a><span class="fu">mean</span>(phenology<span class="sc">$</span>max_swe)                           <span class="co"># The mean of peak SWE for each year, mm</span></span>
<span id="cb110-2"><a href="fate-of-precipitation.html#cb110-2" tabindex="-1"></a><span class="co">#&gt; [1] 550.6222</span></span></code></pre></div>
<p>Based on this, for this site we’ll subset the data using 1-Sep to 31-Aug to be sure an entire winter is in one year. In addition, create a data frame that only includes columns that are needed and only include a single year of data.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="fate-of-precipitation.html#cb111-1" tabindex="-1"></a>snow_data_subset <span class="ot">&lt;-</span> <span class="fu">subset</span>(snow_data, <span class="fu">as.Date</span>(date) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2008-09-01&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb111-2"><a href="fate-of-precipitation.html#cb111-2" tabindex="-1"></a> <span class="fu">as.Date</span>(date) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2009-08-31&quot;</span>))</span>
<span id="cb111-3"><a href="fate-of-precipitation.html#cb111-3" tabindex="-1"></a>snow_data_sel <span class="ot">&lt;-</span> <span class="fu">subset</span>(snow_data_subset, <span class="at">select=</span><span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;snow_water_equivalent&quot;</span>, <span class="st">&quot;precipitation&quot;</span>, <span class="st">&quot;temperature_mean&quot;</span>, <span class="st">&quot;temperature_min&quot;</span>, <span class="st">&quot;temperature_max&quot;</span>))</span>
<span id="cb111-4"><a href="fate-of-precipitation.html#cb111-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.Date</span>(snow_data_sel<span class="sc">$</span>date),snow_data_sel<span class="sc">$</span>snow_water_equivalent,</span>
<span id="cb111-5"><a href="fate-of-precipitation.html#cb111-5" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,<span class="at">xlab =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SWE (mm)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sno-3"></span>
<img src="hydr-watres_main_files/figure-html/sno-3-1.png" alt="Snow water equivalent at SNOTEL site 1050 for Winter 2008-2009." width="60%" />
<p class="caption">
Figure 9.8: Snow water equivalent at SNOTEL site 1050 for Winter 2008-2009.
</p>
</div>
<p>Now use a snow index model to simulate the SWE based on temperature and precipitation. The model used here is a modified version of that used in the <a href="http://hydromad.catchment.org/">hydromad</a> package. The <em>snow.sim</em> command is used to run a snow index model; type <em>?hydromisc::snow.sim</em> for details on its use. As a summary, the four main parameters you can adjust in the calibration of the model are:</p>
<ul>
<li>The maximum air temperature for snow, <em>Tmax</em>. Snow can fall at air temperatures above as high as about 3<span class="math inline">\(^\circ\)</span>C, but <em>Tmax</em> is usually lower.</li>
<li>The minimum air temperature for rain, <em>Tmin</em>. Rain can fall when near surface air temperatures are below freezing. This may be as low as -1<span class="math inline">\(^\circ\)</span>C or maybe just a little lower, and as high as 1<span class="math inline">\(^\circ\)</span>C (though higher than this can be justified in some cases).</li>
<li>Base temperature, <em>Tmelt</em>, the temperature at which melt begins. Usually the default of 0<span class="math inline">\(^\circ\)</span>C is used, but some adjustment (generally between -2 and 2<span class="math inline">\(^\circ\)</span>C) can be applied to improve model calibration.</li>
<li>Snow Melt (Degree-Day) Factor, <em>kd</em>, which describes the melting of the snow when temperatures are above freezing. Be careful using values from different references as these are dependent on units. Typical values are between 1 and 5 mm/d/<span class="math inline">\(^\circ\)</span>C.</li>
</ul>
<p>Two additional parameters are optional; their effects are typically small.</p>
<ul>
<li>Degree-Day Factor for freezing, <em>kf</em>, of liquid water in the snow pack when temperatures are below freezing. By default it is set to 1<span class="math inline">\(^\circ\)</span>C/mm/day, and may vary from 0 to 2 <span class="math inline">\(^\circ\)</span>C/mm/day.</li>
<li>Snow water retention factor, <em>rcap</em>. When snow melts some of it can be retained via capillarity in the snow pack. It can re-freeze or drain out. This is expressed as a fraction of the snow pack that is frozen. The default is 2.5% (rcap = 0.025).</li>
</ul>
<p>Start with some assumed values and run the snow model.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="fate-of-precipitation.html#cb112-1" tabindex="-1"></a>Tmax_snow <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb112-2"><a href="fate-of-precipitation.html#cb112-2" tabindex="-1"></a>Tmin_rain <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb112-3"><a href="fate-of-precipitation.html#cb112-3" tabindex="-1"></a>kd <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-4"><a href="fate-of-precipitation.html#cb112-4" tabindex="-1"></a>Tbase <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-5"><a href="fate-of-precipitation.html#cb112-5" tabindex="-1"></a>snow_estim <span class="ot">&lt;-</span> hydromisc<span class="sc">::</span><span class="fu">snow.sim</span>(<span class="at">DATA =</span> snow_data_sel, </span>
<span id="cb112-6"><a href="fate-of-precipitation.html#cb112-6" tabindex="-1"></a>                                  <span class="at">Tmax =</span> Tmax_snow, </span>
<span id="cb112-7"><a href="fate-of-precipitation.html#cb112-7" tabindex="-1"></a>                                  <span class="at">Tmin =</span> Tmin_rain,</span>
<span id="cb112-8"><a href="fate-of-precipitation.html#cb112-8" tabindex="-1"></a>                                  <span class="at">kd =</span> kd,</span>
<span id="cb112-9"><a href="fate-of-precipitation.html#cb112-9" tabindex="-1"></a>                                  <span class="at">Tmelt =</span> Tbase)</span></code></pre></div>
<p>Now the simulated values can be compared to the observations. If not installed already, install the <a href="https://cran.r-project.org/package=hydroGOF">hydroGOF</a> package, which has some useful functions for evaluating how well modeled output fits observations. In the plot that follows we specify three measures of goodness-of-fit:</p>
<ul>
<li>Mean Absolute Error (MAE)</li>
<li>Percent Bias (PBIAS)</li>
<li>Root Mean Square Error (RMSE) or RMSE divided by the Standard Deviation (RSR)</li>
</ul>
<p>These are discussed in detail in other references, but the aim is to calibrate (change the input parameters) until these values are low.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="fate-of-precipitation.html#cb113-1" tabindex="-1"></a>obs <span class="ot">&lt;-</span> snow_data_sel<span class="sc">$</span>snow_water_equivalent</span>
<span id="cb113-2"><a href="fate-of-precipitation.html#cb113-2" tabindex="-1"></a>sim <span class="ot">&lt;-</span> snow_estim<span class="sc">$</span>swe_simulated</span>
<span id="cb113-3"><a href="fate-of-precipitation.html#cb113-3" tabindex="-1"></a>hydroGOF<span class="sc">::</span><span class="fu">ggof</span>(sim, obs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">dates=</span>snow_data_sel<span class="sc">$</span>date,</span>
<span id="cb113-4"><a href="fate-of-precipitation.html#cb113-4" tabindex="-1"></a>               <span class="at">gofs=</span><span class="fu">c</span>(<span class="st">&quot;MAE&quot;</span>, <span class="st">&quot;RMSE&quot;</span>, <span class="st">&quot;PBIAS&quot;</span>),</span>
<span id="cb113-5"><a href="fate-of-precipitation.html#cb113-5" tabindex="-1"></a>               <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;SWE, mm&quot;</span>, </span>
<span id="cb113-6"><a href="fate-of-precipitation.html#cb113-6" tabindex="-1"></a>               <span class="at">tick.tstep=</span><span class="st">&quot;months&quot;</span>, <span class="at">cex=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sno-5"></span>
<img src="hydr-watres_main_files/figure-html/sno-5-1.png" alt="Simulated and Observed SWE at SNOTEL site 1050 for Winter 2008-2009." width="60%" />
<p class="caption">
Figure 9.9: Simulated and Observed SWE at SNOTEL site 1050 for Winter 2008-2009.
</p>
</div>
<p>Melt is overestimated in the early part of the year and underestimated during the melt season, showing why a single index is not a very robust model. Applying two <em>kd</em> values, one for early to mid snow season and another for later snowmelt could improve the model, but it would make it less useful for using the model in other situations such as increased temperatures.</p>
</div>
<div id="snow-model-calibration" class="section level3 hasAnchor" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> Snow model calibration<a href="fate-of-precipitation.html#snow-model-calibration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While manual model calibration can improve the fit, a more complete calibration involves optimization methods that search the parameter space for the optimal combination of parameter values. The R function <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/optim.html">optim</a>, part of the <em>stats</em> package installed with base R, is efficient at finding a local minimum or maximum to a function. For most hydrologic models finding the global optimum means searching the entire parameter space, since many local minima and maxima usually exist. Some version of Monte Carlo methods are used to do this.</p>
<p>There are many R packages to perform different variations of Monte Carlo simulations, but a simple implementation can be done manually using the <a href="https://cran.r-project.org/package=foreach">foreach</a> package. In this example the four main model parameters are each varied over 10 evenly spaced values, producing <span class="math inline">\(10^4\)</span> unique parameters sets that need to be run. For each run, the function will return a value for RMSE.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="fate-of-precipitation.html#cb114-1" tabindex="-1"></a><span class="co"># package needed for efficiently looping through all simulations</span></span>
<span id="cb114-2"><a href="fate-of-precipitation.html#cb114-2" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb114-3"><a href="fate-of-precipitation.html#cb114-3" tabindex="-1"></a></span>
<span id="cb114-4"><a href="fate-of-precipitation.html#cb114-4" tabindex="-1"></a><span class="co"># Create the sets of values of each parameter within a defined range</span></span>
<span id="cb114-5"><a href="fate-of-precipitation.html#cb114-5" tabindex="-1"></a>p_Tmax <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb114-6"><a href="fate-of-precipitation.html#cb114-6" tabindex="-1"></a>p_Tmin <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb114-7"><a href="fate-of-precipitation.html#cb114-7" tabindex="-1"></a>p_kd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb114-8"><a href="fate-of-precipitation.html#cb114-8" tabindex="-1"></a>p_Tbase <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb114-9"><a href="fate-of-precipitation.html#cb114-9" tabindex="-1"></a></span>
<span id="cb114-10"><a href="fate-of-precipitation.html#cb114-10" tabindex="-1"></a><span class="co"># Assemble them into a data frame with all parameter combinations</span></span>
<span id="cb114-11"><a href="fate-of-precipitation.html#cb114-11" tabindex="-1"></a>p_all <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">Tmax =</span> p_Tmax, <span class="at">Tmin =</span> p_Tmin, <span class="at">kd =</span> p_kd, <span class="at">Tmelt =</span> p_Tbase)</span>
<span id="cb114-12"><a href="fate-of-precipitation.html#cb114-12" tabindex="-1"></a></span>
<span id="cb114-13"><a href="fate-of-precipitation.html#cb114-13" tabindex="-1"></a><span class="co"># Define the function to return a single test statistic for each simulation</span></span>
<span id="cb114-14"><a href="fate-of-precipitation.html#cb114-14" tabindex="-1"></a>fcn <span class="ot">&lt;-</span> <span class="cf">function</span>(datain, Tmax, Tmin, kd, Tmelt){</span>
<span id="cb114-15"><a href="fate-of-precipitation.html#cb114-15" tabindex="-1"></a>  snow_estim <span class="ot">&lt;-</span> hydromisc<span class="sc">::</span><span class="fu">snow.sim</span>(<span class="at">DATA=</span>datain, <span class="at">Tmax=</span>Tmax, <span class="at">Tmin=</span>Tmin, <span class="at">kd=</span>kd, <span class="at">Tmelt=</span>Tmelt)</span>
<span id="cb114-16"><a href="fate-of-precipitation.html#cb114-16" tabindex="-1"></a>  calib.stats <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(hydroGOF<span class="sc">::</span><span class="fu">gof</span>(snow_estim<span class="sc">$</span>swe_simulated,obs,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb114-17"><a href="fate-of-precipitation.html#cb114-17" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.numeric</span>(calib.stats[<span class="st">&#39;RMSE&#39;</span>,]))</span>
<span id="cb114-18"><a href="fate-of-precipitation.html#cb114-18" tabindex="-1"></a>}</span></code></pre></div>
<p>Now the function needs to be used to run the snow model for every parameters combination. What is shown below is how to do this using the <a href="https://cran.r-project.org/package=foreach">foreach</a> package in a brute force manner, running all simulations on a single CPU. This takes a while.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="fate-of-precipitation.html#cb115-1" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(p_all), <span class="at">.combine=</span><span class="st">&#39;c&#39;</span>) <span class="sc">%do%</span> {</span>
<span id="cb115-2"><a href="fate-of-precipitation.html#cb115-2" tabindex="-1"></a>  <span class="fu">fcn</span>(snow_data_sel, p_all[i, <span class="st">&quot;Tmax&quot;</span>], p_all[i, <span class="st">&quot;Tmin&quot;</span>], p_all[i, <span class="st">&quot;kd&quot;</span>], p_all[i, <span class="st">&quot;Tmelt&quot;</span>])</span>
<span id="cb115-3"><a href="fate-of-precipitation.html#cb115-3" tabindex="-1"></a>}</span></code></pre></div>
<p>Because the number of simulations can become very large, this command could be adapted to run the simulations in parallel using multiple cores by using the R package <a href="https://cran.r-project.org/package=doParallel">doParallel</a>, which loads the <code>parallel</code> package (part of the base R installation). By running the <em>foreach</em> simulations with multiple processes, the run time using 7 of 8 available cores dropped from 5.9 minutes for a single CPU to 1.1 minutes. Aside from setting up the cluster before the command and stopping it after (essential for freeing up resources), the only change is the use of <em>%dopar%</em> instead of <em>%do%</em>.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="fate-of-precipitation.html#cb116-1" tabindex="-1"></a><span class="fu">library</span>(doParallel)  </span>
<span id="cb116-2"><a href="fate-of-precipitation.html#cb116-2" tabindex="-1"></a>no_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>  </span>
<span id="cb116-3"><a href="fate-of-precipitation.html#cb116-3" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores=</span>no_cores)  </span>
<span id="cb116-4"><a href="fate-of-precipitation.html#cb116-4" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(no_cores, <span class="at">type=</span><span class="st">&quot;PSOCK&quot;</span>)  <span class="co"># On mac or linux you can change type to &quot;FORK&quot;</span></span>
<span id="cb116-5"><a href="fate-of-precipitation.html#cb116-5" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(p_all), <span class="at">.combine=</span><span class="st">&#39;c&#39;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb116-6"><a href="fate-of-precipitation.html#cb116-6" tabindex="-1"></a>  <span class="fu">fcn</span>(snow_data_sel, p_all[i, <span class="st">&quot;Tmax&quot;</span>], p_all[i, <span class="st">&quot;Tmin&quot;</span>], p_all[i, <span class="st">&quot;kd&quot;</span>], p_all[i, <span class="st">&quot;Tmelt&quot;</span>])</span>
<span id="cb116-7"><a href="fate-of-precipitation.html#cb116-7" tabindex="-1"></a>}</span>
<span id="cb116-8"><a href="fate-of-precipitation.html#cb116-8" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)  </span></code></pre></div>
<p>It can be helpful to look at the four parameters for the simulations that had the lowest RMSE. This presumes the <a href="https://cran.r-project.org/package=tidyverse">tidyverse</a> package has been installed.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="fate-of-precipitation.html#cb117-1" tabindex="-1"></a><span class="co"># Combine results with parameters, sort by RMSE (ascending) </span></span>
<span id="cb117-2"><a href="fate-of-precipitation.html#cb117-2" tabindex="-1"></a>out_all <span class="ot">&lt;-</span> <span class="fu">cbind</span>(p_all, <span class="at">RMSE=</span>out) <span class="sc">|&gt;</span>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(RMSE)</span>
<span id="cb117-3"><a href="fate-of-precipitation.html#cb117-3" tabindex="-1"></a></span>
<span id="cb117-4"><a href="fate-of-precipitation.html#cb117-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb117-5"><a href="fate-of-precipitation.html#cb117-5" tabindex="-1"></a><span class="co"># Plot the parameters for the 10 best runs</span></span>
<span id="cb117-6"><a href="fate-of-precipitation.html#cb117-6" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice</span>(out_all, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb117-7"><a href="fate-of-precipitation.html#cb117-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>RMSE, <span class="at">names_to =</span> <span class="st">&#39;param&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;value&#39;</span>) <span class="sc">|&gt;</span></span>
<span id="cb117-8"><a href="fate-of-precipitation.html#cb117-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> RMSE, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb117-9"><a href="fate-of-precipitation.html#cb117-9" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-10"><a href="fate-of-precipitation.html#cb117-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)  </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sno-opt3"></span>
<img src="hydr-watres_main_files/figure-html/sno-opt3-1.png" alt="Parameter values for the 10 simulations with the lowest RMSE." width="70%" />
<p class="caption">
Figure 9.10: Parameter values for the 10 simulations with the lowest RMSE.
</p>
</div>
<p>There are several occurrences of equal RMSE values, so some points are superimposed on one another. Some parameter values are consistent for all of the 10 best simulations: kd is 2.5 and Tmelt is 2<span class="math inline">\(^\circ\)</span>C, but optimal values can be achieved with a variety of different combinations of Tmax and Tmin. The results using the optimal parameters can be plotted to visualize the simulation.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="fate-of-precipitation.html#cb118-1" tabindex="-1"></a>Tmax_opt <span class="ot">&lt;-</span> <span class="fu">max</span>(out_all<span class="sc">$</span>Tmax[<span class="dv">1</span>],out_all<span class="sc">$</span>Tmin[<span class="dv">1</span>])</span>
<span id="cb118-2"><a href="fate-of-precipitation.html#cb118-2" tabindex="-1"></a>Tmin_opt <span class="ot">&lt;-</span> <span class="fu">min</span>(out_all<span class="sc">$</span>Tmax[<span class="dv">1</span>],out_all<span class="sc">$</span>Tmin[<span class="dv">1</span>])</span>
<span id="cb118-3"><a href="fate-of-precipitation.html#cb118-3" tabindex="-1"></a>kd_opt <span class="ot">&lt;-</span> out_all<span class="sc">$</span>kd[<span class="dv">1</span>]</span>
<span id="cb118-4"><a href="fate-of-precipitation.html#cb118-4" tabindex="-1"></a>Tmelt_opt <span class="ot">&lt;-</span> out_all<span class="sc">$</span>Tmelt[<span class="dv">1</span>]</span>
<span id="cb118-5"><a href="fate-of-precipitation.html#cb118-5" tabindex="-1"></a></span>
<span id="cb118-6"><a href="fate-of-precipitation.html#cb118-6" tabindex="-1"></a>snow_estim_opt <span class="ot">&lt;-</span> hydromisc<span class="sc">::</span><span class="fu">snow.sim</span>(<span class="at">DATA=</span>snow_data_sel,<span class="at">Tmax=</span>Tmax_opt, </span>
<span id="cb118-7"><a href="fate-of-precipitation.html#cb118-7" tabindex="-1"></a>                                      <span class="at">Tmin=</span>Tmin_opt, <span class="at">kd=</span>kd_opt, <span class="at">Tmelt=</span>Tmelt_opt)</span>
<span id="cb118-8"><a href="fate-of-precipitation.html#cb118-8" tabindex="-1"></a>sim_opt <span class="ot">&lt;-</span> snow_estim_opt<span class="sc">$</span>swe_simulated</span>
<span id="cb118-9"><a href="fate-of-precipitation.html#cb118-9" tabindex="-1"></a>hydroGOF<span class="sc">::</span><span class="fu">ggof</span>(sim_opt, obs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">dates=</span>snow_data_sel<span class="sc">$</span>date,</span>
<span id="cb118-10"><a href="fate-of-precipitation.html#cb118-10" tabindex="-1"></a>               <span class="at">gofs=</span><span class="fu">c</span>(<span class="st">&quot;MAE&quot;</span>, <span class="st">&quot;RMSE&quot;</span>, <span class="st">&quot;PBIAS&quot;</span>),</span>
<span id="cb118-11"><a href="fate-of-precipitation.html#cb118-11" tabindex="-1"></a>               <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;SWE, mm&quot;</span>, </span>
<span id="cb118-12"><a href="fate-of-precipitation.html#cb118-12" tabindex="-1"></a>               <span class="at">tick.tstep=</span><span class="st">&quot;months&quot;</span>, <span class="at">cex=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sno-opt4"></span>
<img src="hydr-watres_main_files/figure-html/sno-opt4-1.png" alt="Simulated and Observed SWE at SNOTEL site 1050 for Winter 2008-2009 using the parameter set producing the lowest RMSE." width="60%" />
<p class="caption">
Figure 9.11: Simulated and Observed SWE at SNOTEL site 1050 for Winter 2008-2009 using the parameter set producing the lowest RMSE.
</p>
</div>
<p>It is clear that a simple temperature index model cannot capture the snow dynamics at this location, especially during the winter when melt is significantly overestimated.</p>
<p>The <a href="https://cran.r-project.org/package=FME">FME</a> package, used to solve the Green-Ampt equation above, has a function for Markov Chain Monte Carlo (MCMC) simulation <code>modMCMC</code> that automates the Monte Carlo process using more rigorous sampling, rather than just sampling the entire solution space evenly as illustrated above.</p>
</div>
<div id="estimating-climate-change-impacts-on-snow" class="section level3 hasAnchor" number="9.4.4">
<h3><span class="header-section-number">9.4.4</span> Estimating climate change impacts on snow<a href="fate-of-precipitation.html#estimating-climate-change-impacts-on-snow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once a reasonable calibration is obtained, the effect of increasing temperatures on SWE can be simulated by including the <em>deltaT</em> argument in the <em>hydromisc::snow.sim</em> command. Here a 3<span class="math inline">\(^\circ\)</span>C uniform temperature increase is imposed on the optimal parameterization above.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="fate-of-precipitation.html#cb119-1" tabindex="-1"></a>dT <span class="ot">&lt;-</span> <span class="fl">3.0</span> </span>
<span id="cb119-2"><a href="fate-of-precipitation.html#cb119-2" tabindex="-1"></a>snow_plus3 <span class="ot">&lt;-</span> hydromisc<span class="sc">::</span><span class="fu">snow.sim</span>(<span class="at">DATA=</span>snow_data_sel,</span>
<span id="cb119-3"><a href="fate-of-precipitation.html#cb119-3" tabindex="-1"></a>                      <span class="at">Tmax=</span>Tmax_opt, <span class="at">Tmin=</span>Tmin_opt, <span class="at">kd=</span>kd_opt, <span class="at">Tmelt=</span>Tmelt_opt,</span>
<span id="cb119-4"><a href="fate-of-precipitation.html#cb119-4" tabindex="-1"></a>                      <span class="at">deltaT =</span> dT)</span>
<span id="cb119-5"><a href="fate-of-precipitation.html#cb119-5" tabindex="-1"></a>simplusdT <span class="ot">&lt;-</span> snow_plus3<span class="sc">$</span>swe_simulated</span>
<span id="cb119-6"><a href="fate-of-precipitation.html#cb119-6" tabindex="-1"></a><span class="co"># plot the results</span></span>
<span id="cb119-7"><a href="fate-of-precipitation.html#cb119-7" tabindex="-1"></a>dTlegend  <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="st">&quot;Simulated&quot;</span><span class="sc">*+</span><span class="dv">3</span><span class="sc">~</span>degree<span class="sc">*</span>C)</span>
<span id="cb119-8"><a href="fate-of-precipitation.html#cb119-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.Date</span>(snow_data_sel<span class="sc">$</span>date),obs,<span class="at">type =</span> <span class="st">&quot;l&quot;</span>,<span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SWE (mm)&quot;</span>)</span>
<span id="cb119-9"><a href="fate-of-precipitation.html#cb119-9" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">as.Date</span>(snow_estim<span class="sc">$</span>date),sim_opt,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb119-10"><a href="fate-of-precipitation.html#cb119-10" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">as.Date</span>(snow_estim<span class="sc">$</span>date),simplusdT,<span class="at">lty=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb119-11"><a href="fate-of-precipitation.html#cb119-11" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>, <span class="st">&quot;Simulated&quot;</span>,dTlegend),</span>
<span id="cb119-12"><a href="fate-of-precipitation.html#cb119-12" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb119-13"><a href="fate-of-precipitation.html#cb119-13" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sno-8"></span>
<img src="hydr-watres_main_files/figure-html/sno-8-1.png" alt="Observed SWE and simulated with observed meteorology and increased temperatures." width="60%" />
<p class="caption">
Figure 9.12: Observed SWE and simulated with observed meteorology and increased temperatures.
</p>
</div>
</div>
</div>
<div id="watershed-analysis" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Watershed analysis<a href="fate-of-precipitation.html#watershed-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Whether precipitation falls as rain or snow, how much is absorbed by plants, consumed by evapotranspiration, and what is left to become runoff, is all determined by watershed characteristics. This can include:</p>
<ul>
<li>Watershed area</li>
<li>Slope of terrain</li>
<li>Elevation variability (a hypsometric curve)</li>
<li>Soil types</li>
<li>Land cover</li>
</ul>
<p>Collecting this information begins with obtaining a digital elevation model for an area, identifying any key point or points on a stream (a watershed outlet), and then delineating the area that drains to that point. This process of watershed delineation is often done with GIS software like ArcGIS or QGIS. The R package <a href="https://www.whiteboxgeo.com/manual/wbt_book/r_interface.html">WhiteboxTools</a> provides capabilities for advanced terrain analysis in R.</p>
<p>Demonstrations of the use of these tools for a watershed are in the online book <a href="https://vt-hydroinformatics.github.io/">Hydroinformatics at VT</a> by JP Gannon. In particular, the chapters on <a href="https://vt-hydroinformatics.github.io/rgeoraster.html">mapping a stream network</a> and <a href="https://vt-hydroinformatics.github.io/rgeowatersheds.html">delineating a watershed</a> are excellent resources for exploring these capabilities in R.</p>
<p>For watersheds in the U.S., watersheds, stream networks, and attributes of both can be obtained and viewed using <a href="https://cran.r-project.org/package=nhdplusTools">nhdplusTools</a>. Land cover and soil information can be obtained using the <a href="https://cran.r-project.org/package=FedData">FedData package</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-hydrologic-cycle-and-precipitation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="designing-for-floods-flood-hydrology.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
